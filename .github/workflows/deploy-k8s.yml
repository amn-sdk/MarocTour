name: CD - Deploy to Kubernetes

on:
  push:
    branches: [ "main" ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3



      - name: Update image tags
        run: |
          sed -i "s|IMAGE_BACKEND|${{ secrets.DOCKERHUB_USERNAME }}/maroctour-backend:${{ github.sha }}|g" k8s/backend-deployment.yaml
          sed -i "s|IMAGE_FRONTEND|${{ secrets.DOCKERHUB_USERNAME }}/maroctour-frontend:${{ github.sha }}|g" k8s/frontend-deployment.yaml

      - name: Save updated manifests
        uses: actions/upload-artifact@v4
        with:
          name: kubernetes-manifests
          path: k8s/

      - name: Deployment Instructions
        run: |
          echo "‚úÖ Manifests updated with image tag: ${{ github.sha }}"
          echo ""
          echo "üìù To deploy to your local Minikube cluster:"
          echo "1. Download the artifacts from this workflow run"
          echo "2. Run your local script: ./manual_deploy.sh"
          echo "   (It will apply these files to your local cluster)"
